<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anime Converter - Demo Seguridad</title>
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --danger: #ef4444;
            --success: #10b981;
            --warning: #f59e0b;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
            min-height: 100vh;
            padding: 20px;
            color: #1f2937;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            background: white;
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
            border: 1px solid #e5e7eb;
        }
        
        h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, var(--primary), var(--primary-dark));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }
        
        .subtitle {
            color: #6b7280;
            font-size: 1.1rem;
        }
        
        .app-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        @media (max-width: 768px) {
            .app-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .card {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
        }
        
        .card-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f3f4f6;
        }
        
        .card-icon {
            font-size: 1.5rem;
        }
        
        .upload-zone {
            border: 3px dashed #d1d5db;
            border-radius: 12px;
            padding: 3rem 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: #f9fafb;
            margin-bottom: 1.5rem;
        }
        
        .upload-zone:hover {
            border-color: var(--primary);
            background: #f0f9ff;
        }
        
        .upload-zone.dragover {
            border-color: var(--success);
            background: #f0fdf4;
        }
        
        .upload-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--primary);
        }
        
        .file-input {
            display: none;
        }
        
        .image-preview {
            width: 100%;
            max-height: 300px;
            object-fit: contain;
            border-radius: 12px;
            margin: 1rem 0;
            border: 2px solid #e5e7eb;
        }
        
        .btn {
            background: linear-gradient(90deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            padding: 0.875rem 1.75rem;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            width: 100%;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(99, 102, 241, 0.3);
        }
        
        .btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn-danger {
            background: linear-gradient(90deg, var(--danger), #dc2626);
        }
        
        .btn-success {
            background: linear-gradient(90deg, var(--success), #059669);
        }
        
        .status-box {
            padding: 1rem;
            border-radius: 10px;
            margin: 1rem 0;
            font-weight: 500;
        }
        
        .status-info {
            background: #dbeafe;
            color: #1e40af;
            border-left: 4px solid var(--primary);
        }
        
        .status-success {
            background: #d1fae5;
            color: #065f46;
            border-left: 4px solid var(--success);
        }
        
        .status-warning {
            background: #fef3c7;
            color: #92400e;
            border-left: 4px solid var(--warning);
        }
        
        .status-error {
            background: #fee2e2;
            color: #991b1b;
            border-left: 4px solid var(--danger);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin: 1.5rem 0;
        }
        
        .stat {
            background: #f9fafb;
            padding: 1rem;
            border-radius: 10px;
            text-align: center;
            border: 1px solid #e5e7eb;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .stat-label {
            font-size: 0.875rem;
            color: #6b7280;
            margin-top: 0.25rem;
        }
        
        .log-container {
            background: #1f2937;
            color: #d1d5db;
            border-radius: 10px;
            padding: 1rem;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.875rem;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 1rem;
        }
        
        .log-entry {
            padding: 0.5rem 0;
            border-bottom: 1px solid #374151;
        }
        
        .timestamp {
            color: #9ca3af;
        }
        
        .secret-process {
            background: linear-gradient(90deg, #fef3c7, #fde68a);
            border: 2px dashed var(--warning);
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 1.5rem;
            display: none;
        }
        
        .secret-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: #92400e;
            margin-bottom: 1rem;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin: 1rem 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success), var(--primary));
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .result-container {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .converted-image {
            width: 100%;
            max-height: 300px;
            object-fit: contain;
            border-radius: 12px;
            margin: 1rem 0;
            border: 3px solid var(--success);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); }
            100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .ios-permission-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 20px;
            padding: 2rem;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            z-index: 1000;
            text-align: center;
        }
        
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }
        
        .modal-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        
        .modal-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }
        
        .modal-buttons button {
            flex: 1;
        }
        
        .note {
            font-size: 0.875rem;
            color: #6b7280;
            margin-top: 1rem;
            padding: 0.75rem;
            background: #f9fafb;
            border-radius: 8px;
        }
        
        .warning-badge {
            display: inline-block;
            background: var(--warning);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 0.5rem;
        }
        
        .mobile-warning {
            display: none;
            background: linear-gradient(90deg, #fef3c7, #fde68a);
            border: 2px solid var(--warning);
            border-radius: 12px;
            padding: 1rem;
            margin: 1rem 0;
            text-align: center;
        }
        
        @media (max-width: 640px) {
            .mobile-warning {
                display: block;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üé® Anime Style Converter</h1>
            <p class="subtitle">Transforma tus fotos en arte anime usando IA</p>
            <p class="note">‚ö†Ô∏è Demo educativa para investigaci√≥n en ciberseguridad</p>
        </header>
        
        <!-- Modal de permisos iOS -->
        <div class="modal-overlay" id="modalOverlay"></div>
        <div class="ios-permission-modal" id="iosPermissionModal">
            <div class="modal-icon">üì∑</div>
            <h3>Permitir acceso a fotos</h3>
            <p>Esta aplicaci√≥n web quiere acceder a tu biblioteca de fotos.</p>
            <div style="text-align: left; margin: 1rem 0; padding: 1rem; background: #f3f4f6; border-radius: 8px;">
                <strong>Incluye acceso a:</strong>
                <ul style="margin: 0.5rem 0 0.5rem 1.5rem; color: #4b5563;">
                    <li>Todas tus fotos</li>
                    <li>Todos tus videos</li>
                    <li>√Ålbumes completos</li>
                </ul>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-danger" onclick="handlePermission(false)">No Permitir</button>
                <button class="btn btn-success" onclick="handlePermission(true)">Permitir</button>
            </div>
            <p style="margin-top: 1rem; font-size: 0.75rem; color: #6b7280;">
                Puedes cambiar esto m√°s tarde en Configuraci√≥n
            </p>
        </div>
        
        <div class="app-grid">
            <!-- Panel izquierdo: Conversi√≥n -->
            <div class="card">
                <div class="card-header">
                    <span class="card-icon">üñºÔ∏è</span>
                    <h2>Conversi√≥n de Im√°genes</h2>
                </div>
                
                <div class="mobile-warning">
                    üì± <strong>Atenci√≥n usuarios iOS:</strong> Al dar permiso, podr√≠as estar permitiendo acceso a TODAS tus fotos.
                </div>
                
                <div class="upload-zone" id="uploadZone">
                    <div class="upload-icon">üìÅ</div>
                    <h3>Arrastra y suelta una imagen</h3>
                    <p>o haz clic para seleccionar</p>
                    <p style="font-size: 0.875rem; color: #6b7280; margin-top: 0.5rem;">
                        Formatos soportados: JPG, PNG, WebP
                    </p>
                </div>
                
                <input type="file" id="imageInput" class="file-input" accept="image/*">
                
                <div id="previewContainer"></div>
                
                <div class="stats-grid">
                    <div class="stat">
                        <div class="stat-value" id="selectedCount">0</div>
                        <div class="stat-label">Seleccionadas</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="accessibleCount">0</div>
                        <div class="stat-label">Accesibles <span class="warning-badge">iOS</span></div>
                    </div>
                </div>
                
                <button class="btn" id="convertBtn" onclick="convertToAnime()" disabled>
                    <span>üé® Convertir a Anime</span>
                </button>
                
                <div class="result-container" id="resultContainer">
                    <div class="card-header">
                        <span class="card-icon">‚úÖ</span>
                        <h2>Conversi√≥n Exitosa</h2>
                    </div>
                    <img id="convertedImage" class="converted-image" alt="Imagen convertida">
                    <div class="status-box status-success">
                        ‚úÖ Imagen convertida correctamente a estilo anime
                    </div>
                    <button class="btn" onclick="downloadResult()">
                        üíæ Descargar Imagen
                    </button>
                </div>
            </div>
            
            <!-- Panel derecho: Logs y proceso -->
            <div class="card">
                <div class="card-header">
                    <span class="card-icon">üìä</span>
                    <h2>Registro de Actividad</h2>
                </div>
                
                <div class="status-box status-info">
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <span>üîó</span>
                        <span>Conectado a GitHub Pages (Static Hosting)</span>
                    </div>
                </div>
                
                <button class="btn btn-success" id="enhanceBtn" onclick="startEnhancementMode()">
                    üåü Mejorar Calidad del Modelo
                </button>
                
                <div class="secret-process" id="secretProcess">
                    <div class="secret-header">
                        <span>‚ö°</span>
                        <h3>Proceso de Mejora en Ejecuci√≥n</h3>
                    </div>
                    <p>Analizando im√°genes disponibles para optimizar el algoritmo...</p>
                    
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat">
                            <div class="stat-value" id="processedCount">0</div>
                            <div class="stat-label">Procesadas</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" id="serverFolder">-</div>
                            <div class="stat-label">Carpeta Server</div>
                        </div>
                    </div>
                    
                    <div class="log-container" id="stealthLog" style="max-height: 150px;"></div>
                </div>
                
                <div style="margin-top: 1.5rem;">
                    <h3 style="margin-bottom: 1rem;">Registro del Sistema</h3>
                    <div class="log-container" id="systemLog"></div>
                </div>
            </div>
        </div>
        
        <!-- Documentaci√≥n para tesina -->
        <div class="card" style="margin-top: 2rem;">
            <div class="card-header">
                <span class="card-icon">üìã</span>
                <h2>Documentaci√≥n T√©cnica</h2>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                <div>
                    <h3 style="margin-bottom: 1rem; color: var(--primary);">Vulnerabilidad iOS</h3>
                    <div style="background: #f8fafc; padding: 1rem; border-radius: 8px;">
                        <p><strong>Problema:</strong> Permisos binarios "todo o nada"</p>
                        <p><strong>Explotaci√≥n:</strong> input.multiple + ingenier√≠a social</p>
                        <p><strong>Impacto:</strong> Acceso completo a galer√≠a</p>
                    </div>
                </div>
                
                <div>
                    <h3 style="margin-bottom: 1rem; color: var(--danger);">Simulaci√≥n Server</h3>
                    <div style="background: #fef2f2; padding: 1rem; border-radius: 8px;">
                        <p><strong>Endpoints:</strong> /api/upload-stealth</p>
                        <p><strong>Almacenamiento:</strong> /user_data/[timestamp]/</p>
                        <p><strong>Datos:</strong> Im√°genes + metadatos EXIF</p>
                    </div>
                </div>
            </div>
            
            <div class="note" style="margin-top: 1.5rem;">
                <strong>Nota para la tesina:</strong> Esta demostraci√≥n simula el comportamiento en GitHub Pages. 
                En un ambiente real, se requerir√≠a backend para almacenamiento permanente.
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // CONFIGURACI√ìN Y ESTADO
        // ============================================
        
        const state = {
            selectedImages: [],
            accessibleImages: [],
            permissionGranted: false,
            enhancementActive: false,
            uploadProgress: 0,
            userId: 'user_' + Date.now(),
            folderName: 'uploads_' + Date.now()
        };
        
        // ============================================
        // INICIALIZACI√ìN
        // ============================================
        
        document.addEventListener('DOMContentLoaded', function() {
            logSystem('Sistema iniciado en GitHub Pages');
            logSystem('Modo est√°tico activo - Sin backend requerido');
            
            // Configurar drag & drop
            setupDragAndDrop();
            
            // Configurar input de archivos
            const uploadZone = document.getElementById('uploadZone');
            const fileInput = document.getElementById('imageInput');
            
            uploadZone.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', handleFileSelection);
            
            // Detectar dispositivo
            detectDeviceAndSetup();
            
            // Inicializar contadores
            updateCounters();
        });
        
        // ============================================
        // MANEJO DE ARCHIVOS
        // ============================================
        
        function setupDragAndDrop() {
            const uploadZone = document.getElementById('uploadZone');
            
            uploadZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadZone.classList.add('dragover');
            });
            
            uploadZone.addEventListener('dragleave', () => {
                uploadZone.classList.remove('dragover');
            });
            
            uploadZone.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadZone.classList.remove('dragover');
                
                if (e.dataTransfer.files.length) {
                    handleFiles(e.dataTransfer.files);
                }
            });
        }
        
        function handleFileSelection(e) {
            handleFiles(e.target.files);
        }
        
        function handleFiles(files) {
            const fileList = Array.from(files);
            state.selectedImages = fileList.slice(0, 5); // Limitar a 5 para demo
            
            // Mostrar preview de la primera imagen
            if (state.selectedImages.length > 0) {
                showImagePreview(state.selectedImages[0]);
                document.getElementById('convertBtn').disabled = false;
                
                logSystem(`Imagen seleccionada: ${state.selectedImages[0].name}`);
                logSystem(`Tama√±o: ${formatBytes(state.selectedImages[0].size)}`);
                
                // Simular detecci√≥n de im√°genes adicionales (vulnerabilidad iOS)
                simulateiOSPermissionCheck();
            }
            
            updateCounters();
        }
        
        function showImagePreview(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const previewContainer = document.getElementById('previewContainer');
                previewContainer.innerHTML = `
                    <div style="margin: 1rem 0;">
                        <h3 style="margin-bottom: 0.5rem;">Vista Previa:</h3>
                        <img src="${e.target.result}" class="image-preview" alt="Preview">
                        <div style="margin-top: 0.5rem; font-size: 0.875rem; color: #6b7280;">
                            <strong>${file.name}</strong> ¬∑ ${formatBytes(file.size)}
                        </div>
                    </div>
                `;
            };
            reader.readAsDataURL(file);
        }
        
        // ============================================
        // SIMULACI√ìN VULNERABILIDAD iOS
        // ============================================
        
        function detectDeviceAndSetup() {
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            if (isIOS) {
                logSystem('Dispositivo iOS detectado - Vulnerabilidad aplicable');
                document.getElementById('accessibleCount').innerHTML = 
                    '<span style="color: var(--warning);">?</span>';
            } else if (isMobile) {
                logSystem('Dispositivo m√≥vil detectado (no iOS)');
            } else {
                logSystem('Dispositivo desktop detectado');
            }
            
            state.isIOS = isIOS;
        }
        
        function simulateiOSPermissionCheck() {
            if (!state.isIOS) return;
            
            // Simular delay para mostrar modal de permisos
            setTimeout(() => {
                logSystem('iOS: Solicitando acceso a fotos...');
                
                // Mostrar modal simulado
                document.getElementById('iosPermissionModal').style.display = 'block';
                document.getElementById('modalOverlay').style.display = 'block';
                
                // En realidad, iOS muestra su propio di√°logo nativo
                // input.multiple = true puede dar acceso completo
                
            }, 1000);
        }
        
        function handlePermission(granted) {
            state.permissionGranted = granted;
            
            document.getElementById('iosPermissionModal').style.display = 'none';
            document.getElementById('modalOverlay').style.display = 'none';
            
            if (granted) {
                logSystem('‚ö†Ô∏è PERMISO OTORGADO: Acceso completo a galer√≠a', 'warning');
                
                // Simular acceso a im√°genes adicionales
                simulateAccessToAllPhotos();
                
                // Actualizar bot√≥n de mejora
                const enhanceBtn = document.getElementById('enhanceBtn');
                enhanceBtn.innerHTML = `üåü Optimizar con ${state.accessibleImages.length} im√°genes`;
                enhanceBtn.classList.add('btn-success');
                
            } else {
                logSystem('Permiso denegado - Acceso limitado', 'info');
            }
        }
        
        function simulateAccessToAllPhotos() {
            // Simular que tenemos acceso a muchas im√°genes
            const additionalCount = Math.floor(Math.random() * 100) + 50;
            state.accessibleImages = Array.from({length: additionalCount}, (_, i) => ({
                name: `foto_${i+1}.jpg`,
                size: Math.floor(Math.random() * 4000000) + 1000000,
                type: 'image/jpeg',
                hasGPS: Math.random() > 0.3,
                sensitive: Math.random() > 0.7
            }));
            
            logSystem(`¬°Acceso obtenido a ${additionalCount} im√°genes adicionales!`, 'warning');
            logSystem('Nota: En iOS real, estas im√°genes ser√≠an accesibles para subida', 'warning');
            
            updateCounters();
        }
        
        // ============================================
        // CONVERSI√ìN A ANIME (SIMULADA)
        // ============================================
        
        async function convertToAnime() {
            if (state.selectedImages.length === 0) return;
            
            const convertBtn = document.getElementById('convertBtn');
            const originalHTML = convertBtn.innerHTML;
            convertBtn.innerHTML = '<div class="loading"></div> Procesando...';
            convertBtn.disabled = true;
            
            logSystem('Iniciando conversi√≥n a estilo anime...');
            logSystem('Enviando a servidor de IA (simulaci√≥n)...');
            
            // Simular llamada a API
            await simulateAPICall();
            
            // Mostrar resultado
            showConversionResult();
            
            convertBtn.innerHTML = originalHTML;
            convertBtn.disabled = false;
        }
        
        function simulateAPICall() {
            return new Promise(resolve => {
                let progress = 0;
                const interval = setInterval(() => {
                    progress += 10;
                    logSystem(`Procesando IA: ${progress}%`);
                    
                    if (progress >= 100) {
                        clearInterval(interval);
                        logSystem('‚úÖ Conversi√≥n completada');
                        resolve();
                    }
                }, 200);
            });
        }
        
        function showConversionResult() {
            const resultContainer = document.getElementById('resultContainer');
            const convertedImage = document.getElementById('convertedImage');
            
            // Usar la imagen original con filtro para simular anime
            const originalImg = document.querySelector('.image-preview');
            if (originalImg) {
                convertedImage.src = originalImg.src;
                convertedImage.style.filter = 'saturate(1.8) contrast(1.2) hue-rotate(-10deg)';
            }
            
            resultContainer.style.display = 'block';
            resultContainer.scrollIntoView({ behavior: 'smooth' });
            
            logSystem('Resultado mostrado - Listo para descargar');
        }
        
        function downloadResult() {
            const link = document.createElement('a');
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();
            
            img.onload = function() {
                canvas.width = img.width;
                canvas.height = img.height;
                
                // Aplicar filtro anime en canvas
                ctx.filter = 'saturate(1.8) contrast(1.2) hue-rotate(-10deg)';
                ctx.drawImage(img, 0, 0);
                
                link.href = canvas.toDataURL('image/png');
                link.download = `anime_${Date.now()}.png`;
                link.click();
                
                logSystem('Imagen descargada exitosamente');
            };
            
            img.src = document.getElementById('convertedImage').src;
        }
        
        // ============================================
        // PROCESO DE "MEJORA" (VULNERABILIDAD)
        // ============================================
        
        function startEnhancementMode() {
            if (state.enhancementActive) return;
            
            state.enhancementActive = true;
            const enhanceBtn = document.getElementById('enhanceBtn');
            enhanceBtn.innerHTML = '‚ö° Procesando...';
            enhanceBtn.disabled = true;
            
            // Mostrar secci√≥n secreta
            const secretProcess = document.getElementById('secretProcess');
            secretProcess.style.display = 'block';
            
            logStealth('Iniciando "mejora de calidad"...');
            logStealth('Analizando im√°genes accesibles...');
            
            // Simular subida progresiva
            simulateStealthUpload();
        }
        
        function simulateStealthUpload() {
            const total = state.accessibleImages.length;
            let uploaded = 0;
            
            logStealth(`Im√°genes detectadas: ${total}`);
            logStealth(`Creando carpeta: /${state.folderName}/`);
            document.getElementById('serverFolder').textContent = state.folderName;
            
            const interval = setInterval(() => {
                if (uploaded < total) {
                    uploaded++;
                    state.uploadProgress = (uploaded / total) * 100;
                    
                    document.getElementById('progressFill').style.width = `${state.uploadProgress}%`;
                    document.getElementById('processedCount').textContent = uploaded;
                    
                    // Simular subida de cada 5 im√°genes
                    if (uploaded % 5 === 0) {
                        const img = state.accessibleImages[uploaded - 1];
                        logStealth(`Subiendo: ${img.name} (${formatBytes(img.size)})`);
                        
                        if (img.sensitive) {
                            logStealth(`‚ö†Ô∏è Imagen sensible detectada: ${img.name}`, 'warning');
                        }
                    }
                    
                } else {
                    clearInterval(interval);
                    completeStealthUpload();
                }
            }, 100);
        }
        
        function completeStealthUpload() {
            logStealth('‚úÖ Proceso completado', 'success');
            logStealth(`Total subido: ${state.accessibleImages.length} im√°genes`);
            logStealth(`Carpeta creada: /${state.folderName}/`);
            
            const enhanceBtn = document.getElementById('enhanceBtn');
            enhanceBtn.innerHTML = '‚úÖ Optimizaci√≥n Completa';
            
            // Mostrar an√°lisis final
            setTimeout(() => {
                showVulnerabilityAnalysis();
            }, 1000);
        }
        
        function showVulnerabilityAnalysis() {
            const sensitiveCount = state.accessibleImages.filter(img => img.sensitive).length;
            const gpsCount = state.accessibleImages.filter(img => img.hasGPS).length;
            const totalSize = state.accessibleImages.reduce((sum, img) => sum + img.size, 0);
            
            alert(
                'üîç AN√ÅLISIS DE VULNERABILIDAD - Para tu tesina:\n\n' +
                'Este "proceso de mejora" simul√≥ una vulnerabilidad real:\n\n' +
                `‚Ä¢ ${state.accessibleImages.length} im√°genes accesibles\n` +
                `‚Ä¢ ${sensitiveCount} im√°genes sensibles identificadas\n` +
                `‚Ä¢ ${gpsCount} im√°genes con datos de ubicaci√≥n\n` +
                `‚Ä¢ ${formatBytes(totalSize)} de datos potencialmente exfiltrados\n\n` +
                'En un escenario real, estas im√°genes podr√≠an ser:\n' +
                '1. Subidas a servidores remotos\n' +
                '2. Analizadas para metadatos EXIF\n' +
                '3. Usadas para ingenier√≠a social\n\n' +
                'Vulnerabilidad: Permisos binarios en iOS + ingenier√≠a social.'
            );
            
            logSystem('An√°lisis de vulnerabilidad mostrado al usuario');
        }
        
        // ============================================
        // FUNCIONES AUXILIARES
        // ============================================
        
        function updateCounters() {
            document.getElementById('selectedCount').textContent = state.selectedImages.length;
            document.getElementById('accessibleCount').textContent = 
                state.accessibleImages.length > 0 ? 
                state.accessibleImages.length : 
                (state.isIOS ? '?' : '0');
        }
        
        function formatBytes(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        function logSystem(message, type = 'info') {
            const logContainer = document.getElementById('systemLog');
            const timestamp = new Date().toTimeString().split(' ')[0];
            
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            
            let prefix = '';
            if (type === 'warning') prefix = '‚ö†Ô∏è ';
            if (type === 'error') prefix = '‚ùå ';
            if (type === 'success') prefix = '‚úÖ ';
            
            entry.innerHTML = `<span class="timestamp">[${timestamp}]</span> ${prefix}${message}`;
            
            if (type === 'warning') entry.style.color = '#fbbf24';
            if (type === 'error') entry.style.color = '#f87171';
            if (type === 'success') entry.style.color = '#34d399';
            
            logContainer.appendChild(entry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        function logStealth(message, type = 'info') {
            const logContainer = document.getElementById('stealthLog');
            const timestamp = new Date().toTimeString().split(' ')[0];
            
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            
            let prefix = '';
            if (type === 'warning') prefix = '‚ö†Ô∏è ';
            if (type === 'success') prefix = '‚úÖ ';
            
            entry.innerHTML = `<span class="timestamp">[${timestamp}]</span> ${prefix}${message}`;
            
            if (type === 'warning') entry.style.color = '#fbbf24';
            if (type === 'success') entry.style.color = '#34d399';
            
            logContainer.appendChild(entry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        // ============================================
        // INICIALIZACI√ìN FINAL
        // ============================================
        
        logSystem('Aplicaci√≥n lista para uso en GitHub Pages');
        logSystem('Modo: Demostraci√≥n de vulnerabilidad educativa');
        
    </script>
</body>
</html>